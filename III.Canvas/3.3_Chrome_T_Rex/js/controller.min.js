var Controller=function(){this.model=new Model(0,200,20);this.view=new View};Controller.prototype.keydownFunction=function(a){switch(a.code){case "Space":this.spaceEffect();break;case "ArrowDown":this.model.TRex.down=!0}};Controller.prototype.keyupFunction=function(a){this.down=this.model.TRex.down=!1};
Controller.prototype.reset=function(){this.model.background.cactusSet=[];this.model.background.birds=[];this.model.background.xToMoveGround=0;this.model.TRex.jumpCounter=0;this.model.TRex.jump=!1;this.model.TRex.down=!1;this.model.TRex.posY=this.model.background.posY};Controller.prototype.spaceEffect=function(){this.model.keepPlaying?this.model.TRex.jump=!0:(this.model.TRex.isDead||(this.model.TRex.isDead=!0),this.model.keepPlaying=!0,this.reset())};
Controller.prototype.toJump=function(){9==this.model.TRex.jumpCounter?(this.model.TRex.posY+=this.model.TRex.jumpHight,this.model.TRex.jumpCounter=0,this.model.TRex.jump=!1):(this.model.TRex.jumpCounter++,this.model.TRex.posY=5>=this.model.TRex.jumpCounter?this.model.TRex.posY-this.model.TRex.jumpHight:this.model.TRex.posY+this.model.TRex.jumpHight)};
Controller.prototype.addSet=function(){1==Math.floor(10*Math.random())&&this.model.background.addCloud(this.view.canvas.width);1==Math.floor(2*Math.random())?this.model.background.addBird(this.view.canvas.width):1==Math.floor(2*Math.random())&&this.model.background.addCactus(this.view.canvas.width)};Controller.prototype.testCollision=function(a,c,b,d){return c>=b.posY&&a>=b.posX&&a<=b.posX+d.width};
Controller.prototype.isInCollision=function(){var a=this,c=!1;this.model.background.cactusSet.forEach(function(b){a.testCollision(a.model.TRex.posX,a.model.TRex.posY,b,b.sprite)&&(c=!0)});this.model.background.birds.forEach(function(b){a.model.TRex.down?a.testCollision(a.model.TRex.posX,a.model.TRex.posY-100,b,b.sprites[0])&&(c=!0):a.testCollision(a.model.TRex.posX,a.model.TRex.posY,b,b.sprites[0])&&(c=!0)});return c};
Controller.prototype.canBeIncrease=function(){for(var a=this.model.score;10<=a;)a=(a-a%10)/10;return this.model.score/100==a?!0:!1};Controller.prototype.increaseSpead=function(){this.model.vitesse+=10};
Controller.prototype.loop=function(a){this.model.keepPlaying?(this.view.draw(this.model),this.addSet(),this.model.TRex.jump&&this.toJump(),this.model.score++,this.canBeIncrease()&&this.increaseSpead()):(this.model.score=0,this.model.vitesse=20);this.isInCollision()&&this.model.keepPlaying&&(this.model.keepPlaying=!1,this.model.bestScore<this.model.score&&(this.model.bestScore=this.model.score),this.view.draw(this.model))};
